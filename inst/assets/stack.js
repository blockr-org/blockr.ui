(()=>{"use strict";var e;!function(e){e[e.noStack=1]="noStack",e[e.noBlockIndex=2]="noBlockIndex",e[e.stackAlreadyHasDataBlock=3]="stackAlreadyHasDataBlock",e[e.stackAlreadyHasPlotBlock=4]="stackAlreadyHasPlotBlock",e[e.noStackArea=5]="noStackArea"}(e||(e={}));const t=new Map;t.set(e.noStack,"must drag blocks within a stack"),t.set(e.noStackArea,"cannot place stack here"),t.set(e.noBlockIndex,"could not find block index"),t.set(e.stackAlreadyHasDataBlock,"this stack already includes a data block"),t.set(e.stackAlreadyHasPlotBlock,"this stack already includes a plot block");const a=new Map;var r;a.set(e.noStack,"no-stack"),a.set(e.noBlockIndex,"no-block-index"),a.set(e.stackAlreadyHasDataBlock,"stack-already-has-data-block"),a.set(e.stackAlreadyHasPlotBlock,"stack-already-has-plot-block"),function(e){e[e.deferred=1]="deferred",e[e.throttled=2]="throttled",e[e.immediate=3]="immediate"}(r||(r={}));const o=new Map;o.set(r.deferred,"deferred"),o.set(r.throttled,"throttle"),o.set(r.immediate,"event");const s=e=>{let t=e.id;e.ns&&(t=`${e.ns}-${t}`);const a=o.get(e.priority)||"deferred";console.log(t),Shiny.setInputValue(t,e.message,{priority:a})},n=e=>{const t=e.substring(0,4).normalize();return t[0].toUpperCase()+t.substring(1)+e.substring(4)};let d=!1,c="",l={},i="";const k=o=>{$(document).find(`#${o.ns}-addWrapper`).find(".add-stack").each(((k,p)=>{const g=o.ns,y=$(p).closest(".add-stack-wrapper").data("target");$(p).on("dragstart",(e=>{var t;c=$(e.target).text(),e.originalEvent.dataTransfer.setData("text/plain",null===(t=e.target)||void 0===t?void 0:t.id)})),$(p).on("dragover",(e=>{d=!1,e.preventDefault()})),$(p).on("dragenter",(e=>{s({id:"started",ns:g,message:{type:c},priority:r.immediate}),e.preventDefault()})),$(p).on("dragend",(()=>{if(d)return s({id:"dropped",ns:g,message:{type:c,target:i,data:l},priority:r.immediate}),void(d=!1);(e=>{const o={ns:e.ns,id:"error",message:{type:a.get(e.type)||"unknown error",message:t.get(e.type)||"unknown error"},priority:r.immediate};console.error(`${o.message.message}`),(e=>{if(!e.feedback)return;const a=$(`#${e.ns}-toast`);a.find(".toast-body").text(n(t.get(e.type))||"Unknown error"),a.show(),setTimeout((()=>{a.hide()}),4500)})(e),s(o)})({id:"error",ns:g,type:e.noStackArea,feedback:o.feedback})})),$(y).off("dragover dragenter drop dragdrop"),$(y).on("dragover",(e=>{e.preventDefault()})),$(y).on("dragenter",(e=>{e.preventDefault()})),$(y).on("drop dragdrop",(e=>{d=!0,i=$(e.target).closest(y).attr("id"),l=$(e.target).data()}))}))};$((()=>{Shiny.addCustomMessageHandler("add-stack-init",(e=>{setTimeout((()=>{k(e)}),e.delay)}))}))})();