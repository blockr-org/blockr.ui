(()=>{"use strict";var e;!function(e){e[e.noStack=1]="noStack",e[e.noBlockIndex=2]="noBlockIndex",e[e.stackAlreadyHasDataBlock=3]="stackAlreadyHasDataBlock",e[e.stackAlreadyHasPlotBlock=4]="stackAlreadyHasPlotBlock",e[e.noStackArea=5]="noStackArea"}(e||(e={}));const t=new Map;t.set(e.noStack,"must drag blocks within a stack"),t.set(e.noStackArea,"cannot place stack here"),t.set(e.noBlockIndex,"could not find block index"),t.set(e.stackAlreadyHasDataBlock,"this stack already includes a data block"),t.set(e.stackAlreadyHasPlotBlock,"this stack already includes a plot block");const a=new Map;var o;a.set(e.noStack,"no-stack"),a.set(e.noBlockIndex,"no-block-index"),a.set(e.stackAlreadyHasDataBlock,"stack-already-has-data-block"),a.set(e.stackAlreadyHasPlotBlock,"stack-already-has-plot-block"),function(e){e[e.deferred=1]="deferred",e[e.throttled=2]="throttled",e[e.immediate=3]="immediate"}(o||(o={}));const s=new Map;s.set(o.deferred,"deferred"),s.set(o.throttled,"throttle"),s.set(o.immediate,"event");const r=e=>{let t=e.id;e.ns&&(t=`${e.ns}-${t}`);const a=s.get(e.priority)||"deferred";Shiny.setInputValue(t,e.message,{priority:a})},n=e=>{const t=e.substring(0,4).normalize();return t[0].toUpperCase()+t.substring(1)+e.substring(4)},d=e=>t=>{if(t.key&&"Enter"!=t.key)return;const{target:a}=t,o=$(`#${e.ns}-query`),s=String(null==o?void 0:o.val());""!=s?$(a).closest(".blockr-registry").find(".add-block").each(((e,t)=>{$(t).data("description").includes(s)||$(t).text().includes(s)?$(t).show():$(t).hide()})):$(a).closest(".blockr-registry").find(".add-block").show()},l=()=>{[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new window.bootstrap.Tooltip(e)))};$((()=>{Shiny.addCustomMessageHandler("block-list-init",(e=>{setTimeout((()=>{var t;$(`#${e.id} .block-list-wrapper`).each(((t,a)=>{y(a,e)})),t=e,$(`#${t.ns}-search`).off("click"),$(`#${t.ns}-query`).off("keyup"),$(`#${t.ns}-search`).on("click",d(t)),$(`#${t.ns}-query`).on("keyup",d(t)),[...document.querySelectorAll('[data-bs-toggle="popover"]')].map((e=>new window.bootstrap.Popover(e))),l()}),e.delay)})),Shiny.addCustomMessageHandler("block-list-bind",(e=>{setTimeout((()=>{u(),l()}),e.delay)}))}));let c="",i=0,k="",p=!1;const g=e=>{const t=$(e).closest(".block"),a=t.data("value");let o=0;return t.closest(".stack").find(".block").each(((e,t)=>{$(t).data("value")==a&&(o=e+1)})),o},u=()=>{$(".stack").off("dragover dragenter drop dragdrop"),$(".stack").on("dragover",(e=>{e.preventDefault()})),$(".stack").on("dragenter",(e=>{e.preventDefault()})),$(".stack").on("drop dragdrop",(e=>{p=!0,i<0||(r({id:"dropped",ns:c,message:{type:k,index:i,position:g(e.target),target:$(e.target).closest(".stack").attr("id")},priority:o.immediate}),i=-1)}))},y=(s,d)=>{$(s).hasClass("sorted")||($(s).addClass("sorted"),u(),$(s).find(".add-block").each(((s,l)=>{$(l).on("dragstart",(e=>{var t;(e=>{window.bootstrap.Tooltip.getOrCreateInstance(e).hide()})(e.target),k=$(e.target).data("type"),i=$(e.target).data("index"),c=(e=>{const t=null==e?void 0:e.split("-");return null==t?void 0:t.slice(0,t.length-1).join("-")})($(e.target).closest(".blockr-registry").attr("id")),e.originalEvent.dataTransfer.setData("text/plain",null===(t=e.target)||void 0===t?void 0:t.id)})),$(l).on("dragover",(e=>{p=!1,e.preventDefault()})),$(l).on("dragenter",(e=>{r({id:"started",ns:d.ns,message:{type:k,index:i},priority:o.immediate}),e.preventDefault()})),$(l).on("dragend",(()=>{p||(e=>{(e=>{if(!e.feedback)return;const a=$(`#${e.ns}-toast`);a.find(".toast-body").text(n(t.get(e.type))||"Unknown error"),a.show(),setTimeout((()=>{a.hide()}),4500)})(e);const s={ns:e.ns,id:"error",message:{type:a.get(e.type)||"unknown error",message:t.get(e.type)||"unknown error"},priority:o.immediate};r(s),console.error(`${s.message.message}`)})({id:"error",ns:d.ns,type:e.noStack,feedback:d.feedback})}))})))}})();