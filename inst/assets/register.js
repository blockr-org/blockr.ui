(()=>{"use strict";var t;Sortable,function(t){t[t.noStack=1]="noStack",t[t.noBlockIndex=2]="noBlockIndex",t[t.stackAlreadyHasDataBlock=3]="stackAlreadyHasDataBlock",t[t.stackAlreadyHasPlotBlock=4]="stackAlreadyHasPlotBlock"}(t||(t={}));var e=new Map;e.set(t.noStack,"must drag blocks within a stack"),e.set(t.noBlockIndex,"could not find block index"),e.set(t.stackAlreadyHasDataBlock,"this stack already includes a data block"),e.set(t.stackAlreadyHasPlotBlock,"this stack already includes a plot block");var a,o=new Map;o.set(t.noStack,"no-stack"),o.set(t.noBlockIndex,"no-block-index"),o.set(t.stackAlreadyHasDataBlock,"stack-already-has-data-block"),o.set(t.stackAlreadyHasPlotBlock,"stack-already-has-plot-block"),function(t){t[t.deferred=1]="deferred",t[t.throttled=2]="throttled",t[t.immediate=3]="immediate"}(a||(a={}));var n=new Map;n.set(a.deferred,"deferred"),n.set(a.throttled,"throttle"),n.set(a.immediate,"event");var c=function(t){var n={ns:t.ns,id:"error",message:{type:o.get(t.type)||"unknown error",message:e.get(t.type)||"unknown error"},priority:a.immediate};console.error("".concat(n.message.message)),r(t),s(n)},s=function(t){var e=t.id;t.ns&&(e="".concat(t.ns,"-").concat(e));var a=n.get(t.priority)||"deferred";Shiny.setInputValue(e,t.message,{priority:a})},r=function(t){if(t.feedback){var a=$("#".concat(t.ns,"-toast"));a.find(".toast-body").text(l(e.get(t.type))||"Unknown error"),a.show(),setTimeout((function(){a.hide()}),4500)}},l=function(t){var e=t.substring(0,4).normalize();return e[0].toUpperCase()+e.substring(1)+t.substring(4)},d=function(t){return function(e){if(!e.key||"Enter"==e.key){var a=e.target,o=$("#".concat(t.ns,"-query")),n=String(null==o?void 0:o.val());""!=n?$(a).closest(".blockr-registry").find(".add-block").each((function(t,e){$(e).data("description").includes(n)||$(e).text().includes(n)?$(e).show():$(e).hide()})):$(a).closest(".blockr-registry").find(".add-block").show()}}};$((function(){Shiny.addCustomMessageHandler("block-list-init",(function(t){var e;$("#".concat(t.id," .block-list-wrapper")).each((function(e,a){new Sortable(a,i(t.ns,t.feedback))})),e=t,$("#".concat(e.ns,"-search")).on("click",d(e)),$("#".concat(e.ns,"-query")).on("keyup",d(e))}))}));var i=function(e,o){return{draggable:".add-block",onEnd:function(n){var r=n.originalEvent.srcElement,l=$(r).closest(".stack"),d={id:"error",ns:e,type:t.noStack,feedback:o};if(l.length){var i=$(n.item).data("type"),k=[];$(r).closest(".stack").find("[data-block-type]").each((function(t,e){var a=$(e).data("block-type").split(",");k.push.apply(k,a)}));var u,y=l.attr("id").split("-")[1],b=$(r).closest(".block").data("value");return l.find(".block").each((function(t,e){$(e).data("value")==b&&(u=t+1)})),u?k.includes("dataset_block")&&"dataset_block"==i?(d.type=t.stackAlreadyHasDataBlock,void c(d)):k.includes("plot_block")&&"plot_block"==i?(d.type=t.stackAlreadyHasPlotBlock,void c(d)):void s({id:"block",ns:e,message:{stackId:y,blockId:b,blockIndex:u,type:i},priority:a.immediate}):(d.type=t.noBlockIndex,void c(d))}c(d)}}}})();